import{f as A}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{T as B,a as N}from"./chunk-MSDRGCRR-Coo4BOYm.js";import{ag as O,as as I,ai as K,a0 as Q,bp as V,j as s,b,an as $,ao as G,r as f,f1 as U,f4 as Z,t as y,B as P,R as j,k as J,h as _}from"./index-CZ-S67iV.js";import{u as W,_ as X}from"./chunk-7VJK6HNE-DtAUoiVU.js";import{u as Y}from"./chunk-W7625H47-PZlKd0Q0.js";import"./chunk-Z26G6WFJ-TsWEWtu-.js";import{u as ee}from"./chunk-C76H5USB-CsUh-RbI.js";import{K as se}from"./chunk-6HTZNHPT-CpSPawKt.js";import{R as n,u as te}from"./chunk-4TC5YS65-D0YbeXe5.js";import"./chunk-P3UUX2T6-xHEZ6Rsp.js";import"./chunk-YEDAFXMB-Dvj5Up0c.js";import"./chunk-M3VFKDXJ-BAGYCew2.js";import"./chunk-AOFGTNG6-PoGtryBk.js";import"./chunk-EMIHDNB7-DcuDtbZj.js";import"./chunk-PFKKVLZX-Bt6_Y8-F.js";import"./_isIndex-Be2Qi2V8.js";import"./index-DBEcD-OO.js";var oe=_(),re=()=>{const{t}=b();return f.useMemo(()=>[oe.accessor("id",{header:()=>s.jsx(B,{text:"Provider"}),cell:({getValue:e})=>s.jsx(N,{text:A(e())})})],[t])},ae=({prefix:t,pageSize:e=20})=>{const o=ee(["offset","q","stock_location_id"],t),{offset:i,q:c,stock_location_id:u}=o;return{searchParams:{limit:e,offset:i?Number(i):0,stock_location_id:u,q:c},raw:o}},le=O({fulfillment_providers:I(K()).optional()}),m=50,ie=({location:t})=>{var v,x;const{t:e}=b(),{handleSuccess:o}=te(),i=$({defaultValues:{fulfillment_providers:((v=t.fulfillment_providers)==null?void 0:v.map(r=>r.id))??[]},resolver:G(le)}),{setValue:c}=i,u=((x=t.fulfillment_providers)==null?void 0:x.reduce((r,a)=>(r[a.id]=!0,r),{}))??{},[d,k]=f.useState(u),F=r=>{const a=typeof r=="function"?r(d):r;c("fulfillment_providers",Object.keys(a),{shouldDirty:!0,shouldTouch:!0}),k(a)},{searchParams:w,raw:C}=ae({pageSize:m}),{fulfillment_providers:T,count:p,isLoading:R,isError:E,error:L}=U({...w,is_enabled:!0},{placeholderData:J}),z=Y(),h=ce(),{table:D}=W({data:T??[],columns:h,count:p,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:d,updater:F},getRowId:r=>r.id,pageSize:m}),{mutateAsync:H,isPending:M}=Z(t.id),q=i.handleSubmit(async r=>{var S;const a=(S=t.fulfillment_providers)==null?void 0:S.map(l=>l.id),g=r.fulfillment_providers??[];await H({add:g.filter(l=>!(a!=null&&a.includes(l))),remove:a==null?void 0:a.filter(l=>!g.includes(l))},{onSuccess:({stock_location:l})=>{y.success(e("stockLocations.fulfillmentProviders.successToast")),o(`/settings/locations/${l.id}`)},onError:l=>{y.error(l.message)}})});if(E)throw L;return s.jsx(n.Form,{form:i,children:s.jsxs(se,{onSubmit:q,className:"flex size-full flex-col",children:[s.jsx(n.Header,{}),s.jsx(n.Body,{className:"flex flex-1 flex-col overflow-auto",children:s.jsx(X,{table:D,columns:h,pageSize:m,isLoading:R,count:p,filters:z,search:"autofocus",pagination:!0,orderBy:[{key:"id",label:e("fields.id")}],queryObject:C,layout:"fill"})}),s.jsx(n.Footer,{children:s.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[s.jsx(n.Close,{asChild:!0,children:s.jsx(P,{size:"small",variant:"secondary",type:"button",children:e("actions.cancel")})}),s.jsx(P,{size:"small",isLoading:M,type:"submit",children:e("actions.save")})]})})]})})},ne=_(),ce=()=>{const t=re();return f.useMemo(()=>[ne.display({id:"select",header:({table:e})=>s.jsx(j,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:o=>e.toggleAllPageRowsSelected(!!o)}),cell:({row:e})=>s.jsx(j,{checked:e.getIsSelected(),onCheckedChange:o=>e.toggleSelected(!!o),onClick:o=>{o.stopPropagation()}})}),...t],[t])},we=()=>{const{location_id:t}=Q(),{stock_location:e,isPending:o,isError:i,error:c}=V(t,{fields:"id,*fulfillment_providers"}),u=!o&&!!e;if(i)throw c;return s.jsx(n,{children:u&&s.jsx(ie,{location:e})})};export{we as Component};
